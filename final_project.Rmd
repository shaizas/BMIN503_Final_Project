---
title: "BMIN503/EPID600 Project Template"
author: "Shaiza Sinha"
output: 
  html_document:
    theme: paper 
    highlight: pygments
---
```{r, eval=TRUE}
# packages
library(aod) #logistic regression
library(ggplot2)
library(gtsummary)
library(tidyverse)
library(ggpubr)
library(dplyr)
library(tableone)
```  

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what two faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

>TITLE: Pennsylvania to Philadelphia Landscape Assessment of Social-Demographic Characteristics for Receiving Adequate Prenatal Care in 2020

> ABSTRACT: This project obtained data from the Center for Disease (CDC) WONDER Database 2016-2020 (expanded version), which follows an ad-hoc query system for *the analysis of public health data.* Using a multiple logistic regression model, the study aimed to identify the relationship between select demographic characteristics and receiving adequate prenatal care services with an emphasis on migrant populations in Philadelphia County, PA (n=164) and compare to state-wide performance in Pennsylvania (n=1332). 

>TEAM DETAILS: This project was extensively discussed with the data team with the City of Philadelphia, Department of Public Health (PDPH) within the Maternal, Child, and Family Health Division (MCFH). Members of the data team, MH and AM, have been initialized for the team's privacy. (Names can be found in the discussion comments of the Canvas Submission). The team consisted of a quantitative data analyst specialist (MP) MPH, CPH and the City's chief medical officer MD, MPP. 

> MH MPH, CPH was involved in assisting the development of the statistical approach. Meetings involved discussion of the best statistical process for the data set. MH recommended using multiple logistic regression and determining if prenatal services have been provided adequately through a dichotomous approach (Y/N to receiving adequate prenatal care) to simplify data interpretation. She is in the process of cleaning the Live Births data for Philadelphia (n=20,000), so it will be a much larger dataset. The CDC dataset was used as a preliminary exercise. 

>AM MD, MPP acted in a supervisory role as chief medical officer to guide the selection of maternal social characteristics for assessment and identify the project's social impact. There is currently very little understanding of migrant research and their respective health outcomes in Philadelphia, especially for maternal care.

>The coding material is intended to be used with a different dataset to utilize the findings to identifypotential social barriers. The information from this project will ideally help confirm the need for a larger strategy proposal by acting as a State to City Comparative Landscape Assessment for developing a healthcare service delivery model for prenatal care for migrant individuals and/or undocumented immigrants. 

>https://github.com/shaizas/BMIN503_Final_Project 

### Introduction 
Describe the problem addressed, its, and some background to motivate the problem. Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

>Comprehensive prenatal care has been shown to lead to improved health outcomes for both mothers and newborns.1 If sought early in a birthing person’s pregnancy, antenatal care can be used as an effective preventative measure for adverse health outcomes, such as severe maternal morbidity and low neonatal birth weight.2,3 Services are typically established within the first six to eight weeks of pregnancy, following twelve to fifteen visits in total after the initial visit.4 The current model practiced within the United Citys recommends that patients visit monthly until twenty-eight weeks, bi-weekly until thirty-two weeks, and weekly until delivery.4 Visits are critical to promoting a safe delivery by effectively monitoring the patient's progress and development of the fetus. Healthcare providers are responsible for providing supportive care through medical screenings, lab testing for birth anomalies, image testing, and education (parenting, pregnancy materials, infant feeding).2 Services often include psychosocial support to address substance use, resources for domestic violence, mental health services, avenues for financial aid, and nutritional needs.4

> The City of Philadelphia has a highly urban landscape, with individuals belonging to diverse social and cultural backgrounds that may hinder access to quality prenatal care. In 2020, only 52% of birthing persons sought care within the first trimester in Philadelphia, which is comparatively much lower than the national average of 77%.5,6 The Philadelphia Maternal Mortality Review Committee (MMRC) found that 32% of all pregnancy-associated deaths occurred in birthing persons who didn’t opt in for prenatal care or were too late (third trimester).6  Of these deaths, 69% of individuals, had multiple co-morbidities that would have been screened and identified appropriately had the patient attended regular prenatal visits.6 Overall, more than half of all pregnancy-related deaths that occurred in Philadelphia were deemed preventable.6 These statistics capture the challenges and elucidate potential barriers patients may face to receiving adequate maternal and child care in Philadelphia.  Common barriers include financial constraints, transportation access, lifestyle limitations (childcare, paid time off from work), and overall distrust of the medical field stemming from perceived discrimination and cultural practice.7 Social indicators such as race, age, education levels, socio-economic status have been shown to have associations with receiving adequate prenatal care among migrant populations.  

> Identifying currently underserved populations receiving inadequate access to prenatal services is critical for equitably promoting better maternal and child outcomes. However, there is very limited research in identifying potential social barriers migrant populations face in Philadelphia County.

>**This project aims to determine the relationship between maternal demographic characteristics for birthing persons with an emphasis of migrant individuals who received inadequate prenatal care services using a multiple logistic regression model.**  *This project specifically will assess the social indicators of race, age, and education level, with receiving adequate prenatal care (Y/N: 10 visits made during pregnancy)* For comparative interest, results were compared from a state to city point-of-view to highlight differences in trends. 

>Evaluations will require an intersectional approach for analysis. Biomedical informatics can be an effective tool for statistical analysis to identify the gravity of public health issues. The results can be helpful to many stakeholders within the maternal and child health sector, from community organizations to large-scale hospital systems. An improved understanding of prenatal care adequacy is critical for identifying barriers to eliminating current issues through robust program implementation. 

>The findings of this project will potentially be incorporated into a larger strategy proposal for the City of Philadelphia, which aims to propose a series of recommendations that the Department of Public Health can modify for implementation in Philadelphia to improve antenatal services to undocumented residents. 

### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

>LITERATURE METHODS: The quantitative assessment utilized data from the CDC’S WONDER Database, which collects information on an ad-hoc basis for a variety of public health variables and demographic characteristics. The newest dataset was drawn from the Natality online database, which is compiled of data primarily obtained from birth certificates issued in 2016 to 2020 (most updated version) 

>The actual health outcomes of migrant populations are largely unknown within the City of Philadelphia. The results were conducted to assess if different maternal demographic characteristics specifically if an individual was born outside of the US may affect access to adequeate prenatal services.  In this analysis, a multiple logistic regression was conducted using R Studio. 

>The social indicators of race, age, education level, and maternal nativity (born in the US versus born outside of the US) were selected to determine if adequate prenatal care had been provided to birthing person populations using the Kotelchuck Index in a dichotomous format. According to the American College of Obstetricians and Gynecologists (ACOG) Adequate prenatal care is determined by two variables obtained from birth certificates which include when prenatal care was started and the number of prenatal visits until delivery. On average, a patient will complete twelve to fifteen prenatal visits in total. Typically, adequate care is achieved if a patient has completed 80% or roughly ten appointments. While the Kotelchuck Index cannot determine the quality of prenatal care or accurately be applied for high-risk pregnancies, it remains a commonly utilized method for determining if prenatal care services have been adequately provided. **Using the ACOG guidelines, and for the simplicity of this project, adequate prenatal care was determined if a patient had more than or equal to ten visits <=10.**

>**Statistical Test: Logistic Regressions**
>Assumptions of Dataset: large N, no/few empty small cells,  
>*Dependent variable: Must be Dichotomous/Binary; Received adequate prenatal care (10+ visits) (0=N/1=Y)*
>0: inadequate prenatal care (less than 10 visits)
>1: adequate prenatal care provided (equal to or more than 10 visits)
>*Independent Variables/Observed: can be categorical or continuous; Observed variables: race, age, education level*
>Population: Individuals who gave birth in 2020 (Assessing US-Born vs. Born outside of the US/Migrant)

>CODING METHODS: 

>Results were obtained via CDC Wonder in .txt format and converted into .csv form for easier uploading purposes and readability, the file was uploaded on github and can be accessed below

#Upload dataset into R 
```{r, eval=TRUE}
cdcwonder <- read.csv(url("https://raw.githubusercontent.com/shaizas/BMIN503_Final_Project/master/Natality%2C%202020%20.csv"), header = TRUE)
```

#Get a feel of the dataset first
```{r, eval=TRUE}
#list variables in the df
names(cdcwonder)

#view first few lines of df
head(cdcwonder)

#view structure of df 
str(cdcwonder)

#summary of data
summary (cdcwonder)

#SD of variables
sapply(cdcwonder,sd)
```


#Cleaning Data 

``` {r, eval = TRUE}
#Rename Variables 
library(dplyr)
cdcwonder <- dplyr::rename(cdcwonder, county = County.of.Residence, 
                           age = Age.of.Mother.9.Code,
                           race = Mother.s.Single.Race.6,
                           countycode = County.of.Residence.Code, education = Mother.s.Education.Code, prenatal = Average.Number.of.Prenatal.Visits, maternalnativity=Mother.s.Nativity.Code)

head(cdcwonder)
```

``` {r, eval = FALSE}
#Assess sample size for Philadelphia Births in 2020 
cdcwonder %>%
  filter( county == "Philadelphia County, PA") %>%
  summarise(n())
```

>164 recorded births can be found for Philadelphia in this data set

```{r, eval = TRUE}
#create a clean df for PA 
clean_PA <- cdcwonder %>%
    drop_na(prenatal,maternalnativity,race, age,education) %>% #drop any NA values
  select(prenatal, maternalnativity, race, age, education) %>% #selecting needed variables and social variables 
mutate(prenatal=cut(prenatal,breaks=c(0,10,30),labels=c("0", "1"))) #Converting into dichotomous outcome variable for logistic regression #0:Inadequate Prenatal Care (less than 10 visits), 1: Adequate Prenatal Care (more than or equal to 10 visits)


head(clean_PA)

#create a clean df for Philly
clean_philly <- cdcwonder %>%
    filter(countycode == 42101) %>% # filtering for all Philadelphia births
    drop_na(prenatal,maternalnativity,race,age,education) %>% #drop any NA values
  select(prenatal, maternalnativity, race, age, education) %>% #selecting needed variables and social variables 
  mutate(prenatal=cut(prenatal,breaks=c(0,10,30),labels=c("0", "1"))) #Converting into dichotomous outcome variable for logistic regression #0:Inadequate Prenatal Care (less than 10 visits), 1: Adequate Prenatal Care (more than or equal to 10 visits)
```

```{r, eval = FALSE}
#check to make sure no NA values: Looks good --> changed to false to avoid table
is.na.data.frame(clean_philly) 
is.na.data.frame(clean_PA) 
```

#Check Crosstabs: Assess Adequate Prenatal Care Distribution in PA and in Philadelphia
``` {r, eval = TRUE}

#Create a contingency table of categorical predictors that are binary to make sure that there isn't a cell that is 0 --> Important check for logistic regressions (LRs)

#PA
xtabs(~clean_PA$maternalnativity + race, data=clean_PA)
xtabs(~clean_PA$maternalnativity + education, data=clean_PA)
xtabs(~clean_PA$maternalnativity + age, data=clean_PA)

#Philly --> check is sample size is still usable even if smaller 
xtabs(~clean_philly$maternalnativity + race, data=clean_philly)
xtabs(~clean_philly$maternalnativity + education, data=clean_philly)
xtabs(~clean_philly$maternalnativity + age, data=clean_philly)

#Assess prenatal distribution in PA
ggplot(data=clean_PA, aes(x=prenatal)) + 
    geom_bar()
summary(clean_PA$prenatal)

summary(clean_PA)

#Assess prenatal distribution in Philly
ggplot(data=clean_philly, aes(x=prenatal)) + 
    geom_bar()
summary(clean_philly$prenatal)

summary(clean_philly)
```


>From the graphs above can see the majority of birthing persons in PA receive adequate prenatal care (n=1012) (inadequate prenatal care n=320), however when assessing Philadelphia exclusively **57% of birthing persons are in fact, not receiving adequate prenatal care (n=94 of 164).** Nearly one-third of all inadequate services are solely from Philadelphia County.

#Check Assumptions
``` {r, eval = TRUE}
#Age: convert age to a factor to treat as categorical
clean_PA$age <- factor(clean_PA$age)
clean_philly$age <- factor(clean_philly$age)

#Race:convert race to a factor to treat as categorical
clean_PA$race <- factor(clean_PA$race)
clean_philly$race <- factor(clean_philly$race)
 
#Education: convert race to a factor to treat as categorical
clean_PA$education <- factor(clean_PA$education)
clean_philly$education <- factor(clean_philly$education)
```

###Univariate Logistic Regression Table 

**PA Age**
>AGE: 
>The model with age significantly increased our ability to predict if a birthing person recieved adequate prenatal care over the null model, X^2(1)=76.92, p<0.001
>Holding other predictor variables constant, the log odds of birthing persons aged 25-29 receiving adequate prenatal care is higher than other age groups by a factor of 0.67.

``` {r, eval = TRUE}
#PA Age univariate analysis 
PAage.logistic.model <- glm(prenatal ~ age, data=clean_PA, family="binomial")
summary(PAage.logistic.model)

#chi-square for overall model fit 
#does model fit with x predictor fit better than model with only intercept/null 
with(PAage.logistic.model, null.deviance - deviance)
with(PAage.logistic.model,df.null-df.residual)
with(PAage.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

# NEED TO FIGURE OUT HOW TO SET COMPARATIVE AGE GROUP TO 25-29 INSTEAD OF 15-19: AGE RANGE WITH THE LOWEST RISK ASSOCIATED WITH PREGNANCY

#convert coefficients to OR instead of log-odds 
exp(coef(PAage.logistic.model))

#y'=0.94+2.03(20-24)+3.44(25-29)+5.44(30-34)+6.44(35-39)+6.38(40-44)
#because OR>2L: The likelihood of receiving adequate prenatal care varies by age. 

``` 

**PA Race** 
>RACE: The model with race significantly increased our ability to predict if a birthing person recieved adequate prenatal care over the null model, X^2(1)=78.28, p<0.001

``` {r, eval = TRUE}
#PA race univariate analysis 
PArace.logistic.model <- glm(prenatal ~ race, data=clean_PA, family="binomial")
summary(PArace.logistic.model)

#chi-square for overall model fit 
with(PArace.logistic.model, null.deviance - deviance)
with(PArace.logistic.model,df.null-df.residual)
with(PArace.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

#convert coefficients to OR instead of log-odds 
exp(coef(PArace.logistic.model))

#y'=2.25+0.53(Black or AA)+0.63(More than One Race)+2.06(White)
``` 

**PA Education**
>EDUCATION: The log-odds of education affecting prenatal care overall does not appear significant?! 
>The model with education significantly increased our ability to predict if a birthing person recieved adequate prenatal care over the null model, X^2(1)=309.03, p<0.001

``` {r, eval = TRUE}

#PA education univariate analysis 
PAed.logistic.model <- glm(prenatal ~ education, data=clean_PA, family="binomial")
summary(PAed.logistic.model)

#chi-square for overall model fit 
with(PAed.logistic.model, null.deviance - deviance)
with(PAed.logistic.model,df.null-df.residual)
with(PAed.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

#convert coefficients to OR instead of log-odds 
exp(coef(PAed.logistic.model))

#**none are significant**

```

**PA Maternal Nativity**
>The log-odds of migrant birthing persons receiving adequate prenatal care is lower than US-born birthing persons by a factor of 1.08
>The model for nativity significantly increased our ability to predict if a birthing person recieved adequate prenatal care over the null model, X^2(1)=59.01, p<0.001

``` {r, eval = TRUE}

#PA nativity univariate analysis 

PAnativity.logistic.model <- glm(prenatal ~ maternalnativity, data=clean_PA, family="binomial")
summary(PAnativity.logistic.model)

#chi-square for overall model fit 
with(PAnativity.logistic.model, null.deviance - deviance)
with(PAnativity.logistic.model,df.null-df.residual)
with(PAnativity.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

#convert coefficients to OR instead of log-odds 
exp(coef(PAnativity.logistic.model))

#y'=12.78+ 0.34(maternalnativity)
```

### Multiple Predictor Logistic Variables
>Age 25-29 (0.69, p=0.017), Age 30-39 (1.00, p=0.0015), ages 35-49 (0.87,p=0.014)
>Race White: 0.94, p=0.002
>Nativity -1.37, p=1.28*10-12

``` {r, eval = TRUE}
#PA: LOGISTIC REGRESSION WITH ALL PREDICTORS  
pa.logistic.model <- glm(prenatal ~ age + race + education + maternalnativity, data = clean_PA, family="binomial")
summary (pa.logistic.model)

#chi-square for overall model fit (results should be significant)
with(pa.logistic.model, null.deviance - deviance)
with(pa.logistic.model,df.null-df.residual)
with(pa.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

#convert coefficients to OR instead of log-odds 
exp(coef(pa.logistic.model))

#calculate predicted probabilities 
pa.newdata <- with(clean_PA, data.frame(maternalnativity=factor(1:2)), education=mean(education))

pa.glm.pred <- predict(pa.logistic.model, clean_PA, type="response")
``` 

>Race Black: -1.82, p=0.048
>Nativity -2.79, p=0.00024

``` {r, eval = TRUE}
#PHILLY:LOGISTIC REGRESSION WITH ALL PREDICTORS  
philly.logistic.model<- glm(prenatal ~ age + race + education + maternalnativity, data = clean_philly, family="binomial")
summary (philly.logistic.model)

#chi-square for overall model fit 
with(philly.logistic.model, null.deviance - deviance)
with(philly.logistic.model,df.null-df.residual)
with(philly.logistic.model,pchisq(null.deviance-deviance,df.null-df.residual, lower.tail = FALSE))

#convert coefficients to OR instead of log-odds 
exp(coef(philly.logistic.model))

#calculate predicted probabilities 
philly.glm.pred <- predict(philly.logistic.model, clean_philly, type="response")
```


**Comparatives**
>In Pennsylvania when **holding the other predictor variables constant the log-odds of migrant birthing persons receiving adequate prenatal care is lower than US-born citizens by a factor of 1.37 p<0.001.** 

>In Philadelphia,when **holding the other predictor variables constant the log-odds of migrant birthing persons receiving adequate prenatal care is lower than US-born citizens by a factor of 2.79 p<0.001.** 

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

#Descriptive Table 
``` {r, eval = TRUE}
clean_PA %>% 
  gtsummary::tbl_summary(by = prenatal) %>%
  gtsummary::add_p()

clean_philly %>% 
  gtsummary::tbl_summary(by = prenatal) %>%
  gtsummary::add_p()
``` 

# PA: Analysis of Bivariate relationships for each select predictor with adequate prenatal care outcomes 
``` {r, eval = TRUE}
#Age
clean_PA %>%
  ggplot(aes(x = prenatal, fill = age)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Age") +
    xlab("prenatal") +
    ylab("Count")

#Race
clean_PA %>%
  ggplot(aes(x = prenatal, fill = race)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Race") +
    xlab("prenatal") +
    ylab("Count")

# Education
clean_PA %>%
  ggplot(aes(x = prenatal, fill = education)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Education") +
    xlab("prenatal") +
    ylab("Count")

#Nativity
ggplot(data=clean_PA, aes(x=prenatal)) + 
    geom_bar()
```

# Philly: Analysis of Bivariate relationships for each select predictor with adequate prenatal care outcomes 
``` {r, eval = TRUE}
#Age
clean_philly %>%
  ggplot(aes(x = prenatal, fill = age)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Age") +
    xlab("prenatal") +
    ylab("Count")

#Race
clean_philly %>%
  ggplot(aes(x = prenatal, fill = race)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Race") +
    xlab("prenatal") +
    ylab("Count")

# Education
clean_philly %>%
  ggplot(aes(x = prenatal, fill = education)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Education") +
    xlab("prenatal") +
    ylab("Count")

#Nativity
ggplot(data=clean_philly, aes(x=prenatal)) + 
    geom_bar()
```

# PA+Philly Comparison 
``` {r, eval = FALSE}

pa.age <- clean_PA$age 
philly.age <-clean_philly$age
pa.philly.age <- rbind((pa.age,philly.age))

ggplot(data=pa.philly.age, aes(x=pa.philly.age)) + 
    geom_bar()
#Age
pa.philly.age %>%
  ggplot(aes(x = prenatal, fill = age)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Age") +
    xlab("prenatal") +
    ylab("Count")

#Race
clean_philly %>%
  ggplot(aes(x = prenatal, fill = race)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Race") +
    xlab("prenatal") +
    ylab("Count")

# Education
clean_philly %>%
  ggplot(aes(x = prenatal, fill = education)) +
    geom_bar(position = "dodge") +
    ggtitle("Prenatal Care Outcomes by Education") +
    xlab("prenatal") +
    ylab("Count")

#Nativity
ggplot(data=clean_philly, aes(x=prenatal)) + 
    geom_bar()
```
